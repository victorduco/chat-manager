# üöÄ –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Mini App

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ Secure API –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Heroku: `https://secure-api-miniapp-c0bdba44bbe0.herokuapp.com`
2. ‚úÖ Mini app –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Secure API
3. ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/webapp` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–æ—Ç–∞
4. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è initData –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —á–∞—Ç–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

### 1. –î–æ–±–∞–≤–∏—Ç—å `MINIAPP_URL` –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –±–æ—Ç–∞

–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è mini app, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏.

**–ï—Å–ª–∏ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ:**
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ .env –∏–ª–∏ langgraph-app/.env
echo "MINIAPP_URL=https://your-miniapp-domain.com" >> .env
```

**–ï—Å–ª–∏ –±–æ—Ç –Ω–∞ Heroku:**
```bash
heroku config:set MINIAPP_URL=https://your-miniapp-domain.com -a your-bot-app-name
```

### 2. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å mini app

Mini app –Ω—É–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≥–¥–µ-—Ç–æ (Vercel, Netlify, GitHub Pages, etc.):

```bash
cd miniapp

# –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è Vercel:
npm install
npm run build
vercel --prod

# –ò–ª–∏ –¥–ª—è Netlify:
npm run build
netlify deploy --prod --dir=dist
```

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø–æ–ª—É—á–∏—Ç–µ URL —Ç–∏–ø–∞ `https://your-miniapp.vercel.app`

### 3. –û–±–Ω–æ–≤–∏—Ç—å `MINIAPP_URL` —Å —Ä–µ–∞–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º

```bash
# –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞
echo "MINIAPP_URL=https://your-miniapp.vercel.app" >> .env

# –î–ª—è –±–æ—Ç–∞ –Ω–∞ Heroku
heroku config:set MINIAPP_URL=https://your-miniapp.vercel.app -a your-bot-app-name
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
# –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ:
# Ctrl+C –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞

# –ï—Å–ª–∏ –Ω–∞ Heroku:
heroku restart -a your-bot-app-name
```

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –®–∞–≥ 1: –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É –≤ –≥—Ä—É–ø–ø–µ

1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É –≤ —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ
3. –≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç thread –≤ LangGraph

### –®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ mini app

1. –í —Ç–æ–π –∂–µ –≥—Ä—É–ø–ø–µ –Ω–∞–ø–∏—à–∏—Ç–µ `/webapp`
2. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç –∫–Ω–æ–ø–∫—É "üöÄ –û—Ç–∫—Ä—ã—Ç—å Mini App"
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ mini app

–î–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:

1. ‚úÖ Mini app –æ—Ç–∫—Ä–æ–µ—Ç—Å—è
2. ‚úÖ –í Debug Info –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:
   - `Thread ID (UUID)`: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å UUID (–Ω–µ "–Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω")
   - `Chat ID`: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ID —á–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `-1002557941720`)
3. ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (–∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π")

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ï—Å–ª–∏ Thread ID = "–Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω"

–ó–Ω–∞—á–∏—Ç mini app –Ω–µ –º–æ–∂–µ—Ç –∏–∑–≤–ª–µ—á—å `chat_id` –∏–∑ Telegram.

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (DevTools)
console.log(window.Telegram.WebApp.initDataUnsafe)
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```json
{
  "start_param": "chat_-1002557941720",  // ‚Üê –í–ê–ñ–ù–û!
  "user": {...},
  "chat_instance": "...",
  "chat_type": "supergroup"
}
```

–ï—Å–ª–∏ `start_param` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `MINIAPP_URL`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `/webapp` –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ï—Å–ª–∏ Thread ID –µ—Å—Ç—å, –Ω–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö Secure API:**
```bash
heroku logs --tail -a secure-api-miniapp
```

–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:

1. **401 Unauthorized** - –ø—Ä–æ–±–ª–µ–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π initData
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `TELEGRAM_BOT_TOKEN` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

2. **403 Forbidden** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ —á–∞—Ç–µ
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É—á–∞—Å—Ç–Ω–∏–∫ —ç—Ç–æ–≥–æ —á–∞—Ç–∞

3. **404 Not Found** - thread –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É –≤ —ç—Ç–æ–º —á–∞—Ç–µ

4. **502 Bad Gateway** - LangGraph API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `LANGGRAPH_API_URL`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ curl

```bash
# –ü–æ–ª—É—á–∏—Ç–µ initData –∏–∑ mini app (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ Debug Info)
INIT_DATA="user=%7B%22id%22%3A118497177..."

# –ü–æ–ª—É—á–∏—Ç–µ thread_id (–∏–∑ Debug Info)
THREAD_ID="47f14f5b-c0cc-576f-b96d-fb48deb7aa20"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—Ä–æ—Å
curl -X GET \
  "https://secure-api-miniapp-c0bdba44bbe0.herokuapp.com/threads/${THREAD_ID}/state" \
  -H "X-Telegram-Init-Data: ${INIT_DATA}"
```

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Telegram Group
    ‚Üì —Å–æ–æ–±—â–µ–Ω–∏–µ
Telegram Bot ‚Üí —Å–æ–∑–¥–∞–µ—Ç thread –≤ LangGraph
    ‚Üì —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç metadata
LangGraph Thread:
    thread_id: 47f14f5b-c0cc-576f-b96d-fb48deb7aa20
    metadata: {
        chat_id: "-1002557941720",
        chat_title: "Tst heroku"
    }
    messages: [...]

---

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /webapp –≤ –≥—Ä—É–ø–ø–µ
    ‚Üì
Telegram Bot ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É —Å URL
    URL: https://miniapp.com?startapp=chat_-1002557941720
    ‚Üì
Mini App ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å start_param
    ‚Üì –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç thread_id –∏–∑ chat_id
    thread_id = uuidv5("-1002557941720", NAMESPACE)
    = "47f14f5b-c0cc-576f-b96d-fb48deb7aa20" ‚úÖ
    ‚Üì
Mini App ‚Üí –∑–∞–ø—Ä–æ—Å –∫ Secure API
    GET /threads/47f14f5b-c0cc-576f-b96d-fb48deb7aa20/state
    Header: X-Telegram-Init-Data: ...
    ‚Üì
Secure API:
    1. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç initData (–ø–æ–¥–ø–∏—Å—å) ‚úÖ
    2. –ò–∑–≤–ª–µ–∫–∞–µ—Ç user_id ‚úÖ
    3. –ü–æ–ª—É—á–∞–µ—Ç metadata.chat_id –∏–∑ thread ‚úÖ
    4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç bot.get_chat_member(chat_id, user_id) ‚úÖ
    5. –ï—Å–ª–∏ OK ‚Üí –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –≤ LangGraph ‚úÖ
    ‚Üì
LangGraph API ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç thread state
    ‚Üì
Secure API ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ Mini App
    ‚Üì
Mini App ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è ‚úÖ
```

## üéØ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ Secure API:**
   ```bash
   curl https://secure-api-miniapp-c0bdba44bbe0.herokuapp.com/health
   # –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: {"status":"healthy","bot_configured":true}
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ LangGraph API:**
   ```bash
   curl https://langgraph-server-611bd1822796.herokuapp.com/threads
   # –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–¥–æ–≤
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ—Ç–∞:**
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É –ª—é–±—É—é –∫–æ–º–∞–Ω–¥—É
   - –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥—ã /webapp:**
   - –ù–∞–ø–∏—à–∏—Ç–µ `/webapp` –≤ –≥—Ä—É–ø–ø–µ
   - –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞

5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ mini app:**
   - –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É
   - Mini app –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### "Thread ID (UUID): –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** Mini app –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç `start_param` –æ—Ç Telegram

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª–∏–∫–∞–µ—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –æ—Ç –±–æ—Ç–∞ (–Ω–µ –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ URL)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `MINIAPP_URL` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–æ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ `start_param`

### "–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π"

**–ü—Ä–∏—á–∏–Ω–∞:** Thread —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –ø—É—Å—Ç–æ–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É –≤ —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ
2. –û–±–Ω–æ–≤–∏—Ç–µ mini app (–ø–µ—Ä–µ–∑–∞–π–¥–∏—Ç–µ)

### "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: 403 Forbidden"

**–ü—Ä–∏—á–∏–Ω–∞:** –í—ã –Ω–µ —É—á–∞—Å—Ç–Ω–∏–∫ —ç—Ç–æ–≥–æ —á–∞—Ç–∞ (–∏–ª–∏ –≤—ã—à–ª–∏)

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤ —á–∞—Ç–µ
2. –ï—Å–ª–∏ –≤—ã—à–ª–∏ - –≤–æ–π–¥–∏—Ç–µ –æ–±—Ä–∞—Ç–Ω–æ
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

### "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: 401 Unauthorized"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π initData

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_BOT_TOKEN` –≤ Secure API
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Secure API: `heroku restart -a secure-api-miniapp`

## ‚ú® –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É –≤–∞—Å –±—É–¥–µ—Ç:
- ‚úÖ Secure API —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Telegram
- ‚úÖ Mini app –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ —á–∞—Ç—ã, –∫ –∫–æ—Ç–æ—Ä—ã–º —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å chat_id –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —á—É–∂–∏–º —á–∞—Ç–∞–º
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/webapp` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è mini app
